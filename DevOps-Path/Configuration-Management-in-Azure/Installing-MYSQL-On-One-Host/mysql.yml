# Python MySQL must be installed on the remote hosts. To install:
# apt-get install python-pymysql

---
- hosts: sqlserver01
  become: true
  vars:
    mysql_user: root
    mysql_password: root

  tasks:
  - name: Install pymysql
    shell: apt install python-pymysql -y

  - name: Install MySQL
    apt:
      name: mysql-server
      state: present

  - name: copy cnf
    copy: 
      src: my.cnf
      dest: ~/.my.cnf
      mode: 0644

  - name: MySQL 
    mysql_db:
      name: cbtdata
      state: present

  - name: Configure MySQL users
    mysql_user:
      name: "${{ mysql_user }}"
      host: "%"
      priv: '*.*:ALL'
      state: present
